#!/usr/bin/env ruby

$: << File.dirname(__FILE__) + "/../lib"

require "skyrunner"

require "./jobs/example_job"

logger = Log4r::Logger.new("sky")
logger.outputters << Log4r::StdoutOutputter.new("out")
logger.level = Log4r::DEBUG

SkyRunner.logger = logger

SkyRunner.setup do |config|
  config.dynamo_db_table_name = "skyrunner_jobs_development"
  config.sqs_queue_name = "skyrunner_tasks_development"
end

ExampleJobModule::ExampleJob.new.execute!(number_of_tasks: 7)

trap("INT") do
  SkyRunner.stop_consuming!
end

trap("TERM") do
  SkyRunner.stop_consuming!
end

SkyRunner.consume!
